     1                                  ;*******************************************************************************************************************************
     2                                  ; Program name: "Triangle". This program calculates the third side of a triangle with two sides and an angle of a triangle based on user input
     3                                  ; Copyright (C) 2025  Jonthan Diep                                                                                             *
     4                                  ;                                                                                                                              *
     5                                  ; This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License    *
     6                                  ; as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.        *
     7                                  ; This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty  *
     8                                  ; of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.                *
     9                                  ; You should have received a copy of the GNU General Public License along with this program.  If not, see                      *
    10                                  ; <https://www.gnu.org/licenses/>.                                                                                             *
    11                                  ;*******************************************************************************************************************************
    12                                  
    13                                  
    14                                  
    15                                  ;========1=========2=========3=========4=========5=========6=========7=========8=========9=========0=========1=========2=========3**
    16                                  ; Author information
    17                                  ;   Author name : Jonathan Diep
    18                                  ;   Author email: jonathon.dieppp@csu.fullerton.edu
    19                                  ;   CWID : 884973462
    20                                  ;   Class: 240-03 Section 03
    21                                  ; Program Information
    22                                  ;   Program Name: Triangle
    23                                  ;   Programming language: One module in C, one in X86, and one in bash.
    24                                  ;   Date program began: 2025-Feb-06
    25                                  ;   Date of last update: 2025-Feb-08
    26                                  ;   Files in this program: geometry.c, calculate_triangle.asm, run.sh.
    27                                  ;   Testing: Alpha testing completed. All functions are correct.
    28                                  ;   Status: Ready for release to customers
    29                                  ;
    30                                  ;Purpose
    31                                  ;   This program is a calculator for finding the third side of a triangle based on user input
    32                                  ;
    33                                  ;This file:
    34                                  ;   File name: calculate_triangle.asm
    35                                  ;   Language: X86-64
    36                                  ;   Max page width: 124 columns
    37                                  ;   Assemble (standard): nasm -f elf64 -l calculate_triangle.lis -o calculate_triangle.o calculate_triangle.asm
    38                                  ;   Assemble (debug): nasm -f elf64 -gdwarf -l calculate_triangle.lis -o calculate_triangle.o calculatetriangle.asm
    39                                  ;   Optimal print specification: Landscape, 7 points, monospace, 8Â½x11 paper
    40                                  ;   Prototype of this function: extern double calculate_triangle();
    41                                  ; 
    42                                  ;
    43                                  ;
    44                                  ;
    45                                  ;========1=========2=========3=========4=========5=========6=========7=========8=========9=========0=========1=========2=========3**
    46                                  
    47                                  
    48                                  
    49                                  
    50                                  ;declaration
    51                                  
    52                                  extern printf
    53                                  
    54                                  extern scanf
    55                                  
    56                                  extern fgets
    57                                  
    58                                  extern stdin
    59                                  
    60                                  extern strlen
    61                                  
    62                                  extern cos
    63                                  
    64                                  global calculate_triangle
    65                                  
    66                                  string_size equ 48   ; Assign string_size with 48
    67 00000000 182D4454FB210940        pi dq 3.141592653589793238462643383279502884197
    68 00000008 0000000000000040        two dq 2.0
    69 00000010 0000000000806640        straight dq 180.0
    70                                  
    71                                  
    72                                  segment .data
    73                                  ;declared initialized arrays
    74                                  
    75 00000000 0A506C656173652065-     prompt_for_last_name db 10, "Please enter your last name: ", 0
    75 00000009 6E74657220796F7572-
    75 00000012 206C617374206E616D-
    75 0000001B 653A2000           
    76 0000001F 0A506C656173652065-     prompt_for_title db 10, "Please enter your title (Mr., Ms., Dr., Officer, Sergant, etc: ", 0
    76 00000028 6E74657220796F7572-
    76 00000031 207469746C6520284D-
    76 0000003A 722E2C204D732E2C20-
    76 00000043 44722E2C204F666669-
    76 0000004C 6365722C2053657267-
    76 00000055 616E742C206574633A-
    76 0000005E 2000               
    77                                  
    78 00000060 0A506C656173652065-     prompt_trig_sides db 10, "Please enter the two sides of the triangle seperated by ws: ", 0
    78 00000069 6E7465722074686520-
    78 00000072 74776F207369646573-
    78 0000007B 206F66207468652074-
    78 00000084 7269616E676C652073-
    78 0000008D 657065726174656420-
    78 00000096 62792077733A2000   
    79 0000009E 256C6620256C6600        side_format db "%lf %lf", 0
    80 000000A6 0A506C656173652065-     prompt_trig_angle db 10, "Please enter the angle in degrees between the two sides of the triangle: ", 0
    80 000000AF 6E7465722074686520-
    80 000000B8 616E676C6520696E20-
    80 000000C1 646567726565732062-
    80 000000CA 65747765656E207468-
    80 000000D3 652074776F20736964-
    80 000000DC 6573206F6620746865-
    80 000000E5 20747269616E676C65-
    80 000000EE 3A2000             
    81 000000F1 256C6600                angle_format db "%lf", 0
    82 000000F5 0A546865206C656E67-     result_side3 db 10, "The length of the third side is %.9lf units", 10, 0   ; Rounds the float by 9 decimal places
    82 000000FE 7468206F6620746865-
    82 00000107 207468697264207369-
    82 00000110 646520697320252E39-
    82 00000119 6C6620756E6974730A-
    82 00000122 00                 
    83                                  
    84 00000123 0A506C656173652065-     msg db 10, "Please enjoy your triangle %s %s.", 10, 0
    84 0000012C 6E6A6F7920796F7572-
    84 00000135 20747269616E676C65-
    84 0000013E 2025732025732E0A00 
    85                                  
    86                                  
    87                                  segment .bss
    88                                  ;declared empty arrays
    89                                  
    90                                  align 64
    91 00000000 <res 00000340>          backup_storage_area resb 832
    92                                  
    93 00000340 <res 00000030>          last_name resb string_size   ; Reserving 48 byte for string input
    94 00000370 <res 00000030>          title_name resb string_size   ; 48 byte is optimal for flexibility
    95                                  
    96 000003A0 <res 00000008>          side_1 resq 1   ; Reserving 1 byte for double input
    97 000003A8 <res 00000008>          side_2 resq 1
    98 000003B0 <res 00000008>          angle resq 1
    99                                  
   100                                  segment .text
   101                                  
   102                                  calculate_triangle:
   103                                  
   104                                  ;backup GPRs
   105 00000018 55                      push rbp
   106 00000019 4889E5                  mov rbp, rsp
   107 0000001C 53                      push rbx
   108 0000001D 51                      push rcx
   109 0000001E 52                      push rdx
   110 0000001F 57                      push rdi
   111 00000020 56                      push rsi
   112 00000021 4150                    push r8
   113 00000023 4151                    push r9
   114 00000025 4152                    push r10
   115 00000027 4153                    push r11
   116 00000029 4154                    push r12
   117 0000002B 4155                    push r13
   118 0000002D 4156                    push r14
   119 0000002F 4157                    push r15
   120 00000031 9C                      pushf
   121                                  
   122                                  ;backup other registers
   123 00000032 B807000000              mov rax, 7
   124 00000037 B800000000              mov rax, 0
   125 0000003C 0FAE2425[00000000]      xsave [backup_storage_area]
   126                                  
   127                                  ;output prompt for user input's last name
   128 00000044 B800000000              mov rax, 0
   129 00000049 48BF-                   mov rdi, prompt_for_last_name
   129 0000004B [0000000000000000] 
   130 00000053 E8(00000000)            call printf
   131                                  
   132                                  ;input for user's last name
   133 00000058 B800000000              mov rax, 0
   134 0000005D 48BF-                   mov rdi, last_name
   134 0000005F [4003000000000000] 
   135 00000067 BE30000000              mov rsi, string_size
   136 0000006C 488B1425[00000000]      mov rdx, [stdin]
   137 00000074 E8(00000000)            call fgets
   138                                  
   139                                  ;remove newline from fgets, replacing with null
   140 00000079 B800000000              mov rax, 0
   141 0000007E 48BF-                   mov rdi, last_name
   141 00000080 [4003000000000000] 
   142 00000088 E8(00000000)            call strlen   ; rax = length of last_name + newline
   143 0000008D C680[3F030000]00        mov [last_name+rax-1], byte 0   ; rax points to the index of last_name based on the value it holds 
   144                                                                  ; and replaces it with null
   145                                  
   146                                  ;output prompt for user input's title
   147 00000094 B800000000              mov rax, 0
   148 00000099 48BF-                   mov rdi, prompt_for_title
   148 0000009B [1F00000000000000] 
   149 000000A3 E8(00000000)            call printf
   150                                  
   151                                  ;input for user's title
   152 000000A8 B800000000              mov rax, 0
   153 000000AD 48BF-                   mov rdi, title_name
   153 000000AF [7003000000000000] 
   154 000000B7 BE30000000              mov rsi, string_size
   155 000000BC 488B1425[00000000]      mov rdx, [stdin]
   156 000000C4 E8(00000000)            call fgets
   157                                  
   158                                  ;remove newline from fgets, replacing with null
   159 000000C9 B800000000              mov rax, 0
   160 000000CE 48BF-                   mov rdi, title_name
   160 000000D0 [7003000000000000] 
   161 000000D8 E8(00000000)            call strlen
   162 000000DD C680[6F030000]00        mov [title_name+rax-1], byte 0
   163                                  
   164                                  input_sides:
   165                                  ;prompt for user's input for the two sides of the triangle
   166 000000E4 B800000000              mov rax, 0
   167 000000E9 48BF-                   mov rdi, prompt_trig_sides
   167 000000EB [6000000000000000] 
   168 000000F3 E8(00000000)            call printf
   169                                  
   170                                  ;input for user's two sides of the triangle as a string variable
   171 000000F8 48BF-                   mov rdi, side_format
   171 000000FA [9E00000000000000] 
   172 00000102 48BE-                   mov rsi, side_1
   172 00000104 [A003000000000000] 
   173 0000010C 48BA-                   mov rdx, side_2
   173 0000010E [A803000000000000] 
   174 00000116 E8(00000000)            call scanf
   175                                  
   176                                  ; Move the input values into xmm registers
   177 0000011B F2440F103425-           movsd xmm14, [side_1]   ; Move first side into xmm14 (Dereference to get the value in side_1)
   177 00000121 [A0030000]         
   178 00000125 F2440F103C25-           movsd xmm15, [side_2]   ; Move second side into xmm15 (Dereference to get the value in side_2)
   178 0000012B [A8030000]         
   179                                  
   180                                  input_angle:
   181                                  ; Prompt for user's input for angle between the two sides of the triangle
   182 0000012F B800000000              mov rax, 0
   183 00000134 48BF-                   mov rdi, prompt_trig_angle
   183 00000136 [A600000000000000] 
   184 0000013E E8(00000000)            call printf
   185                                  
   186                                  ; Input for user's triangle angle
   187 00000143 48BF-                   mov rdi, angle_format
   187 00000145 [F100000000000000] 
   188 0000014D 48BE-                   mov rsi, angle
   188 0000014F [B003000000000000] 
   189 00000157 E8(00000000)            call scanf
   190                                  
   191                                  ; Move the input values into xmm registers
   192 0000015C F2440F102C25-           movsd xmm13, [angle]   ; Move first angle into xmm13 (Dereference to get the value in angle)
   192 00000162 [B0030000]         
   193                                  
   194                                  input_calculate:
   195                                  ; Setting values for cos(angle) (calculation: 2(side_1)(side_2)*cos(angle))
   196 00000166 F2450F10E6              movsd xmm12, xmm14   ; Moving side_1 into xmm12
   197 0000016B F2450F59E7              mulsd xmm12, xmm15   ; Multiplying side_1 with side_2 (a * b)
   198 00000170 F2440F592425-           mulsd xmm12, [two]   ; Multiplying two(2.0) with xmm12 (2 * (a*b))
   198 00000176 [08000000]         
   199                                  
   200                                  ; Convert angle in Degrees into Radians
   201 0000017A F2440F592C25-           mulsd xmm13, [pi]   ; d = (d * 3.141592653589793238462643383279502884197)
   201 00000180 [00000000]         
   202 00000184 F2440F5E2C25-           divsd xmm13, [straight]   ; d = d/180
   202 0000018A [10000000]         
   203                                  
   204                                  ; Getting Cos value
   205 0000018E B801000000              mov rax, 1
   206 00000193 F2410F10C5              movsd xmm0, xmm13
   207 00000198 E8(00000000)            call cos   ; cos(d)
   208 0000019D F2440F10E8              movsd xmm13, xmm0
   209                                  
   210                                  ; Getting Squared of side_1
   211 000001A2 F2450F59F6              mulsd xmm14, xmm14   ; (a*a)
   212                                  
   213                                  ; Getting Squared of side_2
   214 000001A7 F2450F59FF              mulsd xmm15, xmm15   ; (b*b)
   215                                  
   216                                  ; Getting the value of the third side
   217 000001AC F2450F58F7              addsd xmm14, xmm15   ; a^2 + b^2
   218 000001B1 F2450F59EC              mulsd xmm13, xmm12   ; (2 *(a*b) * (cos(d)))
   219 000001B6 F2450F10DE              movsd xmm11, xmm14   ; c^2 = a^2 + b^2
   220 000001BB F2450F5CDD              subsd xmm11, xmm13   ; c^2 = a^2 + b^2 - (2 *(a*b) * (cos(d)))
   221 000001C0 F2450F51DB              sqrtsd xmm11, xmm11   ; c = sqrt(a^2 + b^2 - (2 *(a*b) * (cos(d))))
   222                                  
   223                                  ; Print third side
   224 000001C5 B801000000              mov rax, 1   ; Passing 1 float number
   225 000001CA F2410F10C3              movsd xmm0, xmm11
   226 000001CF 48BF-                   mov rdi, result_side3
   226 000001D1 [F500000000000000] 
   227 000001D9 E8(00000000)            call printf
   228                                  
   229                                  ; Print message
   230 000001DE B800000000              mov rax, 0
   231 000001E3 48BF-                   mov rdi, msg
   231 000001E5 [2301000000000000] 
   232 000001ED 48BE-                   mov rsi, title_name
   232 000001EF [7003000000000000] 
   233 000001F7 48BA-                   mov rdx, last_name
   233 000001F9 [4003000000000000] 
   234 00000201 E8(00000000)            call printf
   235                                  
   236                                  ; Move result to stack
   237 00000206 B800000000              mov rax, 0
   238 0000020B 6A00                    push qword 0
   239 0000020D F2440F111C24            movsd [rsp], xmm11
   240                                  
   241                                  ;Restore the values to non-GPRs
   242 00000213 B807000000              mov rax, 7
   243 00000218 BA00000000              mov rdx, 0
   244 0000021D 0FAE2C25[00000000]      xrstor [backup_storage_area]
   245                                  
   246                                  ;Send back side 3 length
   247 00000225 F20F100424              movsd xmm0, [rsp]    ; Move side_3 to xmm0
   248 0000022A 58                      pop rax   ; xmm0 is returned to the main function in the count variable
   249                                  
   250                                                      
   251                                  ; Restore the GPRs
   252 0000022B 9D                      popf
   253 0000022C 415F                    pop r15
   254 0000022E 415E                    pop r14
   255 00000230 415D                    pop r13
   256 00000232 415C                    pop r12
   257 00000234 415B                    pop r11
   258 00000236 415A                    pop r10
   259 00000238 4159                    pop r9
   260 0000023A 4158                    pop r8
   261 0000023C 5E                      pop rsi
   262 0000023D 5F                      pop rdi
   263 0000023E 5A                      pop rdx
   264 0000023F 59                      pop rcx
   265 00000240 5B                      pop rbx
   266 00000241 4889EC                  mov rsp, rbp
   267 00000244 5D                      pop rbp   ;Restore rbp to the base of the activation record of the caller program
   268 00000245 C3                      ret
